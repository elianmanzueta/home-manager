#+title: Dotfiles
#+author: Elian Manzueta
#+date: <2026-01-26 Wed>

* Dots
** Fish
#+begin_src fish :tangle ~/home-manager/stow/.config/fish/config.fish
starship init fish | source
zoxide init fish | source
#+end_src
*** Conf.d
**** Abbreviations
#+begin_src fish :tangle ~/home-manager/stow/.config/fish/conf.d/abbr.fish
abbr -a ls 'eza -lhaF --color=auto --icons=always'
abbr -a l 'eza -lhaF --color=auto --icons=always'
abbr -a lt 'eza --tree'

abbr -a cr 'cargo run'
abbr -a dc 'docker compose'

if type -q nvim
    abbr -a vi 'nvim'
    abbr -a vim 'nvim'
end

if type -q zoxide
    abbr -a cd z
end
#+end_src
***** Git
#+begin_src fish :tangle ~/home-manager/stow/.config/fish/conf.d/abbr.fish
abbr -a gst git status
abbr -a gcsm git commit signoff --message
abbr -a gp git push
abbr -a ga git add
abbr -a gc git clone
#+end_src
***** Emacs
#+begin_src fish :tangle ~/home-manager/stow/.config/fish/conf.d/abbr.fish
if type -q emacsclient
    abbr -a em "emacsclient -c"
    abbr -a et "emacsclient -nw"

    if type -q systemctl
        abbr -a killemacs "systemctl --user stop emacs"
        abbr -a startemacs "systemctl --user start emacs"
    else
        abbr -a killemacs "emacsclient -e \"(kill-emacs)"\"
        abbr -a startemacs "emacs --daemon"
    end

    abbr -a ff vterm_cmd find-file .

    abbr -a orgidp git commit --signoff --message ".orgids"
end
#+end_src
**** Functions
***** upgrade
#+begin_src fish :tangle ~/home-manager/stow/.config/fish/conf.d/abbr.fish
function upgrade --description "Performs updates on a system."
    echo "===============UPDATING PACKAGES==============="
    if type -q pacman
        if type -q paru
            paru -Syu
        else
            pacman -Syu --noconfirm
        end

    else if type -q dnf
        dnf upgrade
    else if type -q apt
        apt update
        apt upgrade -y
    else if type -q brew
        brew upgrade
    end

    if type -q flatpak
        echo "===============UPDATING FLATPAKS==============="
        flatpak upgrade -y
    end

    if type -q doom
        echo "===============UPDATING DOOM EMACS==============="
        doom upgrade
    end
end
#+end_src
**** Homebrew
#+begin_src fish :tangle ~/home-manager/stow/.config/fish/conf.d/brew.fish
if test -d /home/linuxbrew/.linuxbrew
    # Homebrew is installed on Linux

    set -gx HOMEBREW_PREFIX "/home/linuxbrew/.linuxbrew"
    set -gx HOMEBREW_CELLAR "/home/linuxbrew/.linuxbrew/Cellar"
    set -gx HOMEBREW_REPOSITORY "/home/linuxbrew/.linuxbrew/Homebrew"
    set -gx PATH "/home/linuxbrew/.linuxbrew/bin" "/home/linuxbrew/.linuxbrew/sbin" $PATH
    set -q MANPATH; or set MANPATH ''
    set -gx MANPATH "/home/linuxbrew/.linuxbrew/share/man" $MANPATH
    set -q INFOPATH; or set INFOPATH ''
    set -gx INFOPATH "/home/linuxbrew/.linuxbrew/share/info" $INFOPATH

else if test -d /opt/homebrew
    # Homebrew is installed on MacOS
    /opt/homebrew/bin/brew shellenv | source
end
#+end_src
**** Misc
#+begin_src fish :tangle ~/home-manager/stow/.config/fish/conf.d/misc.fish
set -U LSP_USE_PLISTS true
set -U fish_key_bindings fish_vi_key_bindings
set -gx GUIX_PROFILE "/home/elian/.config/guix/current"
#+end_src
**** Paths
#+begin_src fish :tangle ~/home-manager/stow/.config/fish/conf.d/path.fish
switch (uname)
    case Darwin
        # macOS-specific commands
        fish_add_path /Users/elian/.config/emacs/bin
	fish_add_path /etc/profiles/per-user/elian/bin

    case Linux
        # Linux-specific commands
        fish_add_path /home/elian/.local/bin
        fish_add_path /home/elian/.config/emacs/bin/
        fish_add_path /home/elian/.cargo/bin/
end
#+end_src
**** Vterm
#+begin_src fish :tangle ~/home-manager/stow/.config/fish/conf.d/vterm.fish

# Some of the most useful features in emacs-libvterm require shell-side
# configurations. The main goal of these additional functions is to enable the
# shell to send information to `vterm` via properly escaped sequences. A
# function that helps in this task, `vterm_printf`, is defined below.

function vterm_printf
    if begin
            [ -n "$TMUX" ]; and string match -q -r "screen|tmux" "$TERM"
        end
        # tell tmux to pass the escape sequences through
        printf "\ePtmux;\e\e]%s\007\e\\" "$argv"
    else if string match -q -- "screen*" "$TERM"
        # GNU screen (screen, screen-256color, screen-256color-bce)
        printf "\eP\e]%s\007\e\\" "$argv"
    else
        printf "\e]%s\e\\" "$argv"
    end
end

# Completely clear the buffer. With this, everything that is not on screen
# is erased.
if [ "$INSIDE_EMACS" = vterm ]
    function clear
        vterm_printf "51;Evterm-clear-scrollback"
        tput clear
    end
end

# This is to change the title of the buffer based on information provided by the
# shell. See, http://tldp.org/HOWTO/Xterm-Title-4.html, for the meaning of the
# various symbols.
function fish_title
    hostname
    echo "@"
    prompt_pwd
end

# With vterm_cmd you can execute Emacs commands directly from the shell.
# For example, vterm_cmd message "HI" will print "HI".
# To enable new commands, you have to customize Emacs's variable
# vterm-eval-cmds.
function vterm_cmd --description 'Run an Emacs command among the ones defined in vterm-eval-cmds.'
    set -l vterm_elisp ()
    for arg in $argv
        set -a vterm_elisp (printf '"%s" ' (string replace -a -r '([\\\\"])' '\\\\\\\\$1' $arg))
    end
    vterm_printf '51;E'(string join '' $vterm_elisp)
end

# Sync directory and host in the shell with Emacs's current directory.
# You may need to manually specify the hostname instead of $(hostname) in case
# $(hostname) does not return the correct string to connect to the server.
#
# The escape sequence "51;A" has also the role of identifying the end of the
# prompt
function vterm_prompt_end
    vterm_printf '51;A'(whoami)'@'(hostname)':'(pwd)
end

# We are going to add a portion to the prompt, so we copy the old one
functions --copy fish_prompt vterm_old_fish_prompt

function fish_prompt --description 'Write out the prompt; do not replace this. Instead, put this at end of your file.'
    # Remove the trailing newline from the original prompt. This is done
    # using the string builtin from fish, but to make sure any escape codes
    # are correctly interpreted, use %b for printf.
    printf "%b" (string join "\n" (vterm_old_fish_prompt))
    vterm_prompt_end
end

#+end_src
**** WSL
#+begin_src fish :tangle ~/home-manager/stow/.config/fish/conf.d/wsl.fish
if test -f /proc/sys/fs/binfmt_misc/WSLInterop
    set -x DISPLAY (route.exe print | grep 0.0.0.0 | head -1 | awk '{print $4}'):0.0
end
#+end_src
** Homebrew
*** Brewfile
**** Taps
#+begin_src ruby :tangle ./Brewfile
tap "d12frosted/emacs-plus"
#+end_src
**** Casks
#+begin_src ruby :tangle ./Brewfile
cask "Vivaldi"
cask "font-iosevka-term-nerd-font"
cask "jagex"
cask "kitty"
cask "microsoft-auto-update"
cask "microsoft-outlook"
cask "microsoft-teams"
cask "stremio"
#+end_src
**** Code
#+begin_src ruby :tangle ./Brewfile
brew "fish-lsp"

# Python
brew "pyright"
brew "uv"

# Go
brew "go"
brew "gopls"
#+end_src

**** Utilities
***** Terminal
#+begin_src ruby :tangle ./Brewfile
brew "eza"
brew "fd"
brew "fish"
brew "fzf"
brew "gh"
brew "just"
brew "wget"
brew "ripgrep"
brew "starship"
brew "stow"
brew "vips"
brew "zoxide"
brew "bash"
brew "node"
brew "imagemagick"
brew "neovim"
#+end_src

***** Emacs
#+begin_src ruby :tangle ./Brewfile
brew "hunspell"
brew "aspell"
brew "libtool"
brew "cmake"
brew "coreutils"
brew "gcc"
brew "d12frosted/emacs-plus/emacs-plus@30"
#+end_src
